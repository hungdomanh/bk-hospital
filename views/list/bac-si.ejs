<% include ../layout.ejs %>

<script src="/javascripts/list.js"></script>

<div class='content' ng-controller="bacsiCtrl">
	<div class="container">
		<div class='row col-xs-12'>
			<div class='col-xs-5 search'>
				Tìm Kiếm: <input type="text" ng-model='search'>
			</div>
			<div class='col-xs-2 add'>
				<button ng-click="setAdd()" data-target='#bacsiAddFormModal' data-toggle="modal" class="addButton" ng-show=<%-type=='boss'%>>
					Thêm mới
				</button>
			</div>
			<div class='col-xs-5 sort' ng-init="sort='mabs'">
				Sắp xếp:
				<select ng-model="sort">
		          <option value="mabs">Mã Bác Sĩ</option>
		          <option value="hoten">Họ Tên</option>
		          <option value="ngaysinh">Ngày Sinh</option>
		          <option value="gioitinh">Giới Tính</option>
		          <option value="diachi">Địa Chỉ</option>
		          <option value="kinhnghiem">Kinh Nghiệm</option>
		        </select>
			</div>
		</div>

		<table>
			<tr class="days">
		       <th scope="col" title="Monday">Mã</th>
		       <th scope="col" title="Tuesday">Họ Tên</th>
		       <th scope="col" title="Wednesday">Ngày Sinh</th>
		       <th scope="col" title="Thursday">Giới Tính</th>
		       <th scope="col" title="Friday">Địa Chỉ</th>
		       <th scope="col" title="Saturday">Kinh Nghiệm</th>
		       <th scope="col" title="Sunday">Trạng Thái</th>
		       <th scope="col" title="admin">Quản trị</th>
		     </tr>
		  <tr ng-repeat="x in data | orderBy: sort | filter: search track by $index">
		    <td>{{ x.mabs}}</td>
		    <td>{{ x.hoten }}</td>
		    <td>{{ x.ngaysinh }}</td>
		    <td>{{ x.gioitinh }}</td>
		    <td>{{ x.diachi }}</td>
		    <td>{{ x.kinhnghiem }}</td>
		    <td>{{ x.trangthai }}</td>
		    <td ng-show=<%-type=='boss'%> >
		    	<button ng-click="setEdit(x.mabs)" class="editButton" data-target='#bacsiEditFormModal' data-toggle="modal" >
		    		Sửa
		    	</button>
		    	<a ng-href="/delete-bacsi/{{x.mabs}}">
		    	<button class="deleteButton" >Xóa</button>
		    	</a>
		    </td>

		  </tr>
		</table>

	<!-- Add Form Modal -->
	<div class="modal fade" id="bacsiAddFormModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
	  <div class="modal-dialog" role="document">
	    <div class="modal-content">
	    <form action="/add-bac-si" method="post">
		      <div class="modal-header">
		        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>Thêm mới</h4>
		      </div>
		      <div class="modal-body">
		        Mã Bác Sĩ: {{mabsAdd}} <input type="hidden" value={{mabsAdd}} name="mabs"><br><br>
		        Họ Tên: <input type="text" name="hoten"><br><br>
		        Ngày Sinh: <input type="date" name="ngaysinh"><br><br>
		        Giới tính: <input type="radio" name="sex" value="nam" />Nam
						   <input type="radio" name="sex" value="nu" />Nữ<br><br>
		        Địa chỉ: <input type="text" name="diachi"><br><br>
		        Năm Kinh Nghiệm: <input type="number" name="kinhnghiem"> năm<br><br>
		        Trạng thái: Hoạt động:<input type="checkbox" name="kinhnghiem"><br>
		      </div>
		      <div class="modal-footer">
		        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
		        <button type="submit" class="btn btn-primary" value="Save">Save</button>
		      </div>
	     </form>
	    </div>
	  </div>
	</div>



	<!-- Edit Form Modal -->
	<div class="modal fade" id="bacsiEditFormModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
	  <div class="modal-dialog" role="document">
	    <div class="modal-content">
	    <form action="/edit-bac-si" method="post">
		      <div class="modal-header">
		        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>Chỉnh sửa</h4>
		      </div>
		      <div class="modal-body">
		        Mã Bác Sĩ: {{mabsEdit}} <input type="hidden" value={{mabsEdit}} name="mabs"><br><br>
		        Họ Tên: <input type="text" value={{hotenEdit}} name="hoten"><br><br>
		        Ngày Sinh: <input type="date" value={{ngaysinhEdit}} name="ngaysinh"><br><br>
		        Giới tính: <input type="radio" value="nam" ng-model='nam' name="sex" />Nam
						   <input type="radio" value="nu" ng-model='nu' name="sex" />Nữ<br><br>
		        Địa chỉ: <input type="text" value={{diachiEdit}} name="diachi"><br><br>
		        Năm Kinh Nghiệm: <input type="number" value={{kinhnghiemEdit}} name="kinhnghiem"> năm<br><br>
		         Trạng thái: Hoạt động: <input type="checkbox" value={{trangthaiEdit}}) name="kinhnghiem"><br>
		      </div>
		      <div class="modal-footer">
		        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
		        <button type="submit" class="btn btn-primary" value="Save">Save</button>
		      </div>
	     </form>
	    </div>
	  </div>
	</div>


	</div>  <!-- container -->
</div>  <!-- controller -->

<script>
	app.controller('bacsiCtrl', ['$scope', function($scope){

		 var s = '<%-data%>';
		 var data = JSON.parse(s);
		 // console.log(data.length); 
		 $scope.data = data;

		 $scope.setEdit = function(index){
		 	for(var i =0; i<data.length; i++) {
		 		if(data[i].mabs == index)	{
		 			$scope.mabsEdit = data[i].mabs;
		 			$scope.hotenEdit = data[i].hoten;
		 			$scope.ngaysinhEdit = data[i].ngaysinh;
		 			if(data[i].gioitinh == 'Nam') {
		 				$scope.nam = true;
		 				$scope.nu = false;
		 			}
		 			else {
		 				$scope.nam = false;
		 				$scope.nu = true;
		 			}

		 			$scope.diachiEdit = data[i].diachi;
		 			$scope.kinhnghiemEdit = data[i].kinhnghiem;
		 			$scope.trangthaiEdit = data[i].trangthai;

		 		}
		 	}
		 }

		$scope.setAdd = function(index){
			var test = 0;
		 	for(var i =0; i<data.length-1; i++) {
		 		if(data[i+1].mabs - data[i].mabs > 1) {
		 			$scope.mabsAdd = data[i].mabs+1;
		 			test = 1;
		 		}
		 	}
		 	if(test == 0) {
		 		$scope.mabsAdd = data[data.length-1].mabs+1;
		 	}
		 };


	}]);

</script>



